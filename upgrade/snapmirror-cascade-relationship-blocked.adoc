---
permalink: upgrade/snapmirror-cascade-relationship-blocked.html
sidebar: sidebar
keywords: ontap, upgrade, update, cascade, LTR, long term retention, snapshots, considerations, secondary storage
summary: 'Mitigate issues related to ONTAP blocking configurations that include SnapMirror relationships within a cascade topology'
---
= Mitigate issues due to a SnapMirror relationship within a cascade topology
:icons: font
:imagesdir: ../media/

[.lead]
Before you upgrade ONTAP, you should determine if you are using a SnapMirror relationship within a cascade topology. This configuration is not supported in ONTAP 9.10.1 later and will be blocked after upgrade. Continuing to use this configuration could result in missed backups and Snapshots.

Cascading a volume with LTR Snapshots enabled is not supported. Configuration issues might occur due to Long-Term Retention (LTR) Snapshots configured on the "B" volume in an *A > B > C* SnapMirror cascade or in another middle SnapMirror destination volume in a larger cascade. LTR Snapshots are defined by a schedule applied to a SnapMirror policy rule. This rule does not replicate Snapshots from the source volume but creates them directly on the destination volume. For more information on schedules and SnapMirror policies, see https://kb.netapp.com/on-prem/ontap/DP/SnapMirror/SnapMirror-KBs/How_does_the_schedule_parameter_in_an_ONTAP_9_SnapMirror_policy_rule_work[this KB^].

.Steps

. Remove the LTR rule from middle SnapMirror policy:
+
----
Secondary::> snapmirror policy remove-rule -vserver <> -policy <> -snapmirror-label <>
----

. Add the rule again for this SnapMirror label without the LTR schedule:
+
----
Secondary::> snapmirror policy add-rule -vserver <> -policy <> -snapmirror-label <> -keep <>
----
+
NOTE: Removing LTR Snapshots from the SnapMirror policy rules means SnapMirror will pull the Snapshots with the given label from the source volume. You might also need to add or modify a schedule on the source volume's Snapshot policy to create properly-labeled Snapshots.

. If necessary, modify (or create) a schedule on the source volume snapshot policy to allow snapshots to be created with a SnapMirror label:
+
----
Primary::> volume snapshot policy modify-schedule -vserver <> -policy <> -schedule <> -snapmirror-label <>
----
+
----
Primary::> volume snapshot policy add-schedule -vserver <> -policy <> -schedule <> -snapmirror-label <> -count <>
----

NOTE: LTR Snapshots can still be enabled on the final SnapMirror destination volume within a SnapMirror cascade configuration.

// 2024-July 1, ONTAPDOC-2127