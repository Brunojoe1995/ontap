---
permalink: upgrade/check-cpu-utilization.html
sidebar: sidebar
keywords: upgrade, cluster, limits, verify, san
summary: 'Excessive CPU utilization during an ONTAP upgrade could lead to a performance degradation while each node in the cluster is in takeover. You should check the CPU utlization before you perform an upgrade'
---
= Check CPU and disk utilization before upgrade
:icons: font
:imagesdir: ../media/

[.lead]
Excessive CPU utilization during an ONTAP upgrade could lead to a performance degradation while each node in the cluster is in takeover. You should monitor the utilization before the upgrade to verify that it does not exceed 50%.

CPU and disk utilization can vary at different times in your environment. Therefore, it is best to check your CPU and disk utilization during the timeframe of your anticipated upgrade window. 

// start tabbed area

[role="tabbed-block"]
====

.CLI
--
. Determine the CPU and disk utilization: `node run -node node_name -command sysstat -c 10 -x 3`
+
You should monitor CPU and disk utilization for 30 seconds. The values in the *CPU* and *Disk Util* columns should not exceed 50% for all 10 measurements reported. No additional load should be added to the cluster until the upgrade is complete.
--

.Active IQ
--

. View the historical CPU utilization on the cluster for the past week or month:  *Active IQ Node view > CPU Utilization graph*

If CPU utilization is constantly above 50%, use link:https://docs.netapp.com/us-en/active-iq-unified-manager-99/performance-checker/reference-understanding-and-using-the-node-failover-planning-page.html[Active IQ Unified Manager node failover planning] to determine if predicted latencies during upgrade are acceptable. If predicted latencies are unacceptable, consider reducing or load balancing the workload across the cluster.

--
====

// end tabbed area

NOTE: If utilization is above 50%, but the workload is all background I/O, you do not need to reduce or load balance the workload.  High utilization caused by I/O operations will not cause performance degradation during takeover. 


The 'peak_performance' line is a calculated value of CPU headroom or potential and is explained in further detail here: What is â€˜PEAK PERFORMANCE line in Active IQ

.Related information

* link:https://kb.netapp.com/onprem/ontap/Performance/How_to_check_for_background_CPU_utilization_in_ONTAP_9[Knowledge base article: How to check for background CPU utilizaiton in ONTAP 9]
* link:https://kb.netapp.com/onprem/ontap/Performance/What_is_%22PEAK_PERFORMANCE%22_line_in_Active_IQ%3F[Knowledge based article: What is "PEAK_PERFOMANCE" line in Active IQ or the headroom in ONTAP?]

// 2023 Jul 25, Jira 1183