---
permalink: san-admin/asa-iscsi-lif-fo-task.html
sidebar: sidebar
keywords: failover, iscsi, all san array, cli, system manager, auto-revert, revert network interface
summary: Beginning with ONTAP 9.11.1 on All SAN Array (ASA) platforms, the iSCSI LIF failover feature supports automatic and manual migration of iSCSI LIFs in an SFO partner failover (when an iSCSI LIF moves from its home node/port to its HA partner node/port and back again) and in a local failover (when an iSCSI LIF moves from its unhealthy port to a healthy port on its current home node and back again). This feature provides faster I/O resumption for SAN workloads running on ISCSI.
---
= iSCSI LIF failover for ASA platforms
:icons: font
:imagesdir: ../media/

[.lead]
Beginning with ONTAP 9.11.1 on All SAN Array (ASA) platforms, the iSCSI LIF failover feature supports automatic and manual migration of iSCSI LIFs in an SFO partner failover (when an iSCSI LIF moves from its home node/port to its HA partner node/port and back again) and in a local failover (when an iSCSI LIF moves from its unhealthy port to a healthy port on its current home node and back again). This feature provides faster I/O resumption for SAN workloads running on ISCSI.

* The automatic movement of an iSCSI LIF is a LIF failover (and auto-revert), which is triggered in certain events, such as planned or unplanned failover, a physical ethernet link down, or a node dropping out of replicated database (RDB) quorum.
** After upgrading your ASA HA pair to ONTAP 9.11.1, this feature is automatically enabled on newly created iSCSI LIFs if no iSCSI LIFs exist in the specified storage VM or if all existing iSCSI LIFs in the specified storage VM are already enabled with iSCSI LIF failover.
** For iSCSI LIFs created prior to upgrading to ONTAP 9.11.1, to use the iSCSI LIF failover feature, you must enable it using the ONTAP CLI. (Enabling the failover feature and auto-revert capability means changing the failover policy to “sfo-partner-only” and designating the auto-revert value to “true”.) 

.About this task
The following list describes how this feature works:

* For LIFs using the `data-iscsi` service policy, the failover-policy is restricted to `sfo-partner-only`, `local-only`, and `disabled`
* iSCSI LIFs can failover only to the HA partner when their failover policy is set to `sfo-partner-only`
* Giveback happens when the giveback policy is set to `auto-revert true` and the node comes back in quorum
* When there is a planned or unplanned node takeover, the iSCSI LIF on the node which is taken-over fails over to the HA partner; the port on which the LIF fails over is determined by the VIF Manager
* Once the failover is complete, the iSCSI LIF operates normally
* When a giveback is initiated, the iSCSI LIF reverts back to its home node and port

== System Manager procedure

Beginning with ONTAP 9.11.1, you can use System Manager to migrate an iSCSI LIF from an ASA platform which is going down to its HA partner before the home-node goes down. The ability to migrate and revert are enabled by default on ASA platforms.

=== Failover
.Steps
.	In System Manager, click *Network > Overview > Network Interfaces*
.	Select the LIF you want to migrate, then click image:icon_kabob.gif[Kabob Icon], and then click *Migrate*.
. In the *Migrate Interface* dialog box, select the destination node and port of the HA partner.
.	Click *Migrate*.

=== Giveback
.Steps
.	In System Manager, click *Network > Overview > Network Interfaces*.
.	Select the LIF  you want to revert, then click image:icon_kabob.gif[Kabob Icon] and then click *Revert Network Interface*.
. In the *Revert Network Interface* dialog box, click *Revert*.

== CLI procedure

Beginning with ONTAP 9.11.1, use the following commands on an ASA platform, to create and manage iSCSI LIFs. The ability to failover and auto-revert are enabled by default._

|===

h| If you want to... h| Use this command...

|Create an iSCSI LIF
|`network interface create -vserver _SVM_name_ -lif _iscsi_lif_ -service-policy default-data-blocks -data-protocol iscsi -home-node _node_name_ -home-port _port_name_`
|Verify that the LIF was created successfully
|`network interface show -vserver _SVM_name_ -fields failover-policy,failover-group,auto-revert,is-home`
|Verify if you can override the auto-revert default on iSCSI LIFs
|`network interface modify -vserver _SVM_name_ -lif iscsi_lif -auto-revert false`

You will receive an error: `Error: command failed: auto-revert cannot be disabled on SAN LIFs.`

|Perform a storage failover on an iSCSI LIF
|`storage failover takeover -ofnode _node_name_ -option normal`

You will receive a warning: `A takeover will be initiated. Once the partner node reboots, a giveback will be automatically initiated. Do you want to continue? {y/n}:`

A `y` response will display a takeover message from its HA partner.
|===

// 22 MAR 2022, Jira IE-523
