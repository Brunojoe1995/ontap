---
permalink: s3-config/create-bucket-lifecycle-rule-task.html
sidebar: sidebar
keywords: s3, bucket, cli, lifecycle, rule 
summary: "Beginning with ONTAP 9.13.1, you can implement S3 object expiration."
---

= Create a bucket lifecycle management rule
:icons: font
:imagesdir: ../media/

[.lead]
You can create lifecycle management rules to manage object lifecycle in your S3 buckets. You can define deletion rules for specific objects in a bucket, and through these rules, expire those bucket objects. This enables you to meet retention requirements and manage overall S3 object storage efficiently.
##Modified the lead sentence##

.Before you begin

An S3-enabled SVM containing an S3 server and a bucket must already exist. See link:create-svm-s3-task.html[Create an SVM for S3] for more information.

.About this task
##Modified this section##

The procedure you follow depends on the interface that you use â€” the CLI or System Manager. When creating your lifecycle management rules, you can apply the following deletion actions to your bucket objects:

* Deletion of current versions - This action expires objects identified by the rule. If versioning is enabled on the bucket, S3 makes all expired objects unavailable. If versioning is not enabled, this rule deletes the objects permanently. The CLI action is `Expiration`.
* Deletion of non-current versions - This action specifies when S3 can permanently remove non-current objects. The CLI action is `NoncurrentVersionExpiration`.
* Deletion of expired delete markers - This action deletes expired object delete markers.
In versioning-enabled buckets, objects with a delete markers become the current versions of the objects. The objects are not deleted, and no action can be performed on them. These objects become expired when there are no current versions associated with them. The CLI action is `Expiration`.
* Deletion of incomplete multipart uploads - This action sets a maximum time (in days) that you want to allow multipart uploads to remain in progress. Following which, they are deleted. The CLI action is `AbortIncompleteMultipartUpload`.

== Manage lifecycle management rules by the CLI
##Restructured this section##

Beginning with ONTAP 9.13.1, you can use the CLI to create lifecycle management rules to expire objects in your S3 buckets.

.What you'll need
For the CLI, you need to define the required fields for each expiration action type when creating a bucket lifecycle management rule. These fields can be modified after initial creation. The following table displays the unique fields for each action type.

[cols="30,70"]
|===

h| Action type h| Unique fields

a|
NonCurrentVersionExpiration
a|
* `-non-curr-days` - Number of days after which non-current versions will be deleted
* `-new-non-curr-versions` - Number of latest non-current versions to be retained
a|
Expiration
a|
* `-obj-age-days` - Number of days since creation, after which current version of objects can be deleted
* `-obj-exp-date` - Specific date when the objects should expire
* `-expired-obj-del-markers` - Cleanup object delete markers
a|
AbortIncompleteMultipartUpload
a|
* `-after-initiation-days` - Number of days of initiation, after which upload can be aborted
a|
|===

In order for the bucket lifecycle management rule to only be applied to a specific subset of objects, admins must set each filter when creating the rule. If these filters are not set when creating the rule, the rule will be applied to all objects within the bucket. 

All filters can be modified after initial creation _except_ for the following: +

* `-prefix`
* `-tags`
* `-obj-size-greater-than`
* `-obj-size-less-than`

.Steps
. Use the `vserver object-store-server bucket lifecycle-management-rule create` command with required fields for your expiration action type to create your bucket lifecycle management rule.

.Example

The following command creates a NonCurrentVersionExpiration bucket lifecycle management rule:

----
vserver object-store-server bucket lifecycle-management-rule create -vserver <svm_name> -bucket <bucket_name> -rule-id <rule_name> -action NonCurrentVersionExpiration -index <lifecycle_rule_index_integer> -is-enabled {true|false} -prefix <object_name> -tags <text> -obj-size-greater-than {<integer>[KB|MB|GB|TB|PB]} -obj-size-less-than {<integer>[KB|MB|GB|TB|PB]} -new-non-curr-versions <integer> -non-curr-days <integer>
----


.Example

The following command creates an Expiration bucket lifecycle management rule:

----
vserver object-store-server bucket lifecycle-management-rule create -vserver <svm_name> -bucket <bucket_name> -rule-id <rule_name> -action Expiration -index <lifecycle_rule_index_integer> -is-enabled {true|false} -prefix <object_name> -tags <text> -obj-size-greater-than {<integer>[KB|MB|GB|TB|PB]} -obj-size-less-than {<integer>[KB|MB|GB|TB|PB]} -obj-age-days <integer> -obj-exp-date <"MM/DD/YYYY HH:MM:SS"> -expired-obj-del-marker {true|false}
----


.Example

The following command creates an AbortIncompleteMultipartUpload bucket lifecycle management rule:

----
vserver object-store-server bucket lifecycle-management-rule create -vserver <svm_name> -bucket <bucket_name> -rule-id <rule_name> -action AbortIncompleteMultipartUpload -index <lifecycle_rule_index_integer> -is-enabled {true|false} -prefix <object_name> -tags <text> -obj-size-greater-than {<integer>[KB|MB|GB|TB|PB]} -obj-size-less-than {<integer>[KB|MB|GB|TB|PB]} -after-initiation-days <integer>
----

== Manage lifecycle management rules by System Manager
##Added this section##

Beginning with ONTAP 9.14.1, you can implement object expiration by using System Manager. By using System Manager, you can add, edit, delete lifecycle management rules for your S3 objects. Additionally, you can import a lifecycle rule created for one bucket and utilize it for the objects in another bucket. You can disable an active rule for enabling it later.

=== Add a lifecycle management rule
. Click *Storage > Buckets*.
. Select the bucket for which you want to specify the expiration rule.
. Click the image:icon_kabob.gif[kebab icon] icon and select *Manage lifecycle rules*. You go to the Lifecycle rules tab.
. Click *Add > Lifecycle rule*.
. On the Add a lifecycle rule page, add the name of the rule.
. Define the scope of the rule, whether you want it to apply to all the objects in the bucket or on specific objects. If you want to specify objects, add at least one of the following filter criteria:
..	Prefix: Specify a prefix of the object key names to which the rule should apply. Typically, it is the path or folder of the object. You can enter one prefix per rule. Unless a valid prefix is provided, the rule applies to all the objects in a bucket.
..	Tags: Specify up to three key and value pairs (tags) for the objects to which the rule should apply. Only valid keys are used for filtering. The value is optional. However, if you add keys, ensure that you add only valid values for the corresponding keys.
.. Size: You can limit the scope between the minimum and maximum sizes of the objects. You can enter either or both the values. The default unit is MiB.
. Specify the action:
.. *Expire the current version of objects*: Set a rule to make all current objects permanently unavailable after a specific number of days since their creation, or on a specific date. This option is unavailable if the Delete expired object delete markers option is selected.
.. *Permanently delete noncurrent versions*: Specify the number of days after which the version becomes non-current, and thereafter can be deleted, and the number of versions to retain.
.. *Delete expired object delete markers*: Select this action to delete objects with expired delete markers, that is delete markers without an associated current object.
+
[NOTE] 
This option becomes unavailable when you select the Expire the current version of objects option that automatically deletes all objects after the stipulated time. This action becomes unavailable when object tags are used for filtering.
+
.. *Delete incomplete multipart uploads*: Set the number of days after which incomplete multipart uploads are to be deleted. If the multipart uploads that are in progress fail within the specified time, you can delete the incomplete multipart uploads. This action becomes unavailable when object tags are used for filtering.
.. Click *Save*.

=== Import a lifecycle rule

. Click *Storage > Buckets*.
. Select the bucket for which you want to import the expiration rule.
. Click the image:icon_kabob.gif[kebab icon] icon and select *Manage lifecycle rules*. You go to the Lifecycle rules tab.
. Click *Add > Import a rule*. You see the Import lifecycle rule screen.
. Select the bucket from which you want to import the rule. The lifecycle management rules defined for the selected bucket appear.
. Select the rule that you want to import. You have the option to select one rule at a time, with the default selection being the first rule.
. Click *Import*.

=== Edit, delete, or disable a rule
. Click *Storage > Buckets*.
. Select the bucket for which you want to edit, delete, or disable the lifecycle management rule.
. Click the image:icon_kabob.gif[kebab icon] icon and select *Manage lifecycle rules*. You go to the Lifecycle rules tab.
. Select the required rule. You can edit and disable one rule at a time, and delete multiple rules together.
. Select *Edit*, *Delete*, or *Disable*, and complete the procedure.

[NOTE] 
When editing a rule, you can edit only the lifecycle management actions associated with the rule. If the rule was filtered with object tags, then the *Delete expired object delete markers* and *Delete incomplete multipart uploads* options are unavailable. Disabling a rule changes the button label from *Disable* to *Enable*. On deletion, a rule ceases to apply on the designated objects.



// 2023 Apr 13, Jira IDR-228
// 27-Sep-2023 ONTAPDOC-1147 