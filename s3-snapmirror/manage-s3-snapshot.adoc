---
sidebar: sidebar
permalink: s3-snapmirror/manage-s3-snapshot.html
keywords: s3 snapshots, manage S3 snapshots
summary: You can browse and delete S3 bucket snapshots using the S3 Snapshot technology. 
---

= Manage and restore S3 Snapshot copies
:toclevels: 1
:hardbreaks:
:nofooter:
:icons: font
:linkattrs:
:imagesdir: ../media/

[.lead]
The ONTAP S3 snapshot feature enables you to browse S3 snapshots for your buckets, restore them when you need to, and delete them when they are no longer useful for you. 

.Before you begin
For managing ONTAP S3 snapshots on your buckets, the snapshots should have been created and should be accessible to you. 

== Browse S3 snapshots
You browse S3 snapshots to view their details, compare them, and identify and rectify errors. If you notice any failures or issues in your environment, you can browse the content of the S3 snapshots for a bucket to identify and fix the error, or restore a previous, error-free version.

Using the ONTAP CLI, you can list all snapshots created on your S3 buckets. 


.Steps
. List and browse S3 snapshots:

----
vserver object-store-server bucket snapshot show
----
You can view the snapshot names, storage VMs, buckets, and creation time for all the S3 snapshots created for your buckets on the cluster.

Specifying the bucket name retrieves the name and creation time of all the S3 snapshots created for that bucket.

----
vserver object-store-server bucket snapshot show -vserver <vserver_name> -bucket <bucket_name>
----


== Restore S3 snapshots

You can restore ONTAP S3 snapshots only locally. You can link:../s3-snapmirror/manage-s3-snapshot.html#browse-s3-snapshots[browse] snapshots and determine the snapshot content to copy objects from the required snapshots and restore. You can restore the entire bucket, objects with a prefix, or a single object, by using the `aws s3 cp` command. 

.Steps

. Take a snapshot of the S3 bucket that you will replace by the S3 snapshot restore.
+
----
vserver object-store-server bucket snapshot create -vserver <vserver_name> -bucket <bucket_name> -snapshot <snapshot_name>
----
+
. Perform the restore:
** Restore an entire bucket:
+
----
aws --endpoint http://<IP> s3 cp s3://website-data-<synthetic-bucket-name> s3://website-data  --recursive
----
+
In this case, use the bucket name of the synthetic bucket, that is in the format `<base-bucket-name>-s3snap-<snapshot-name>`.
+
** Restore objects under a directory with the default prefix `s3snap`:
+
----
aws --endpoint http://<IP> s3 cp s3://website-data-s3snap-<snapshot_name>/dir1 s3://website-data/dir1 --recursive
----
+
** Restore a single object with the default prefix `s3snap`:
+
----
aws --endpoint http://<IP> s3 cp s3://website-data-s3snap-<snapshot_name>/web.py s3://website-data/web.py
----

== Delete S3 snapshots
You can delete S3 snapshots that you no longer require and free up storage space in your buckets. You can manually remove S3 snapshots or modify the S3 snapshot policies to schedule their removal. 

Specifying the retention period in the S3 snapshot policies ensures the snapshots to be maintained for a specified period. Policies for S3 snapshots follow the same deletion rules as other ONTAP snapshot policies. Post the retention period specified in the S3 snapshot policies, the S3 snapshots are automatically deleted. For more information about creating snapshot policies, refer to https://docs.netapp.com/us-en/ontap/data-protection/create-snapshot-policy-task.html[Create a snapshot policy^].

.About this task

* An S3 snapshot deletion request (manual or policy-driven) removes the corresponding records from the S3 snapshot database.
*  If multiple snapshots maintain versions of the same S3 object that is eventually deleted, the object is completely deleted from the buckets (original and synthetic) only when the last snapshot protecting it is removed.
* If you need to delete an S3 bucket containing objects with snapshots, ensure that you have deleted all the corresponding snapshots of all the objects in that bucket.
* You can't delete an S3 snapshot that is being restored.
* If you need to revert a cluster to an ONTAP version earlier than ONTAP 9.16.1, ensure that you have deleted all the S3 snapshots for all the buckets.
* When you delete snapshots in batches, you can remove a large number of objects captured in several snapshots, effectively freeing up more space than individual snapshot deletion would cause. As a result, you can reclaim more space for your storage objects.

.Steps

. To delete S3 snapshots manually, run this command: 
+
----
vserver object-store-server bucket snapshot delete
----
+
. Optionally, you can free up additional space by deleting the history of the redundant snapshots:
+
----
vserver object-store-server bucket snapshot delete -vserver <vserver_name> -bucket <bucket_name> -snapshot snapshot*
----
 

