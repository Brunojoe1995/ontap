---
sidebar: sidebar
permalink: s3-snapmirror/manage-s3-snapshot.html
keywords: s3 snapshots, manage S3 snapshots
summary: You can browse and delete S3 bucket snapshots using the S3 Snapshot technology. 
---

= Manage and restore S3 Snapshot copies
:toclevels: 1
:hardbreaks:
:nofooter:
:icons: font
:linkattrs:
:imagesdir: ../media/

[.lead]
With the S3 Snapshot feature, you have the option to manually generate snapshots or set up snapshot policies to automatically create them. Snapshots serve as static copies of objects that you use for data backup and recovery. For determining the tenure of snapshot retention, you can create snapshot policies that facilitate automatic snapshot creation at specified intervals.

.Before you begin

.About this task

.Steps
You can manually create a Snapshot copy by using the ONTAP CLI. The procedure creates a Snapshot copy on the local cluster only.

. Create a snapshot:

----
vserver object-store-server bucket snapshot create -vserver <vserner-name> -bucket <bucket-name> -snapshot <snapshot-name>
----

The following example creates a Snapshot copy named `pre-update` on the `vs0` storage VM and `website-data` bucket:

----
vserver object-store-server bucket snapshot create -vserver vs0 -bucket website-data -snapshot pre-update
----

== Browse S3 snapshots
You browse S3 snapshots to view their details, compare them, and identify and rectify errors from the snapshots. Using the ONTAP CLI, you can list all snapshots created on ONTAP S3 buckets. 



From the S3 protocol side, snapshots will be presented as a synthetic bucket with bucket name formatted as

.Steps
. View snapshot:

----
vserver object-store-server bucket snapshot show
----

You can view the snapshot names, storage VMs, buckets, and creation time for all the snapshots on the cluster.

<base-bucket-name>-s3snap-<snapshot-name>

The synthetic snapshot buckets will be returned in the ListBuckets result. 

When browsing the object in snapshot, the "expiration" header of the object won't be populated in the HeadObject and GetObject response even if the lifecycle rules are configured on the bucket.

which is occasionally updated. Two days ago, the developers noticed that something in the AI training runs were failing.  Luckily, Alex has set up a snapshot policy with a daily schedule that retains one week worth of these daily snapshots.

Alex identifies the nightly snapshots for the last few days, and starts attempting to bisect when the issue started. 

vserver object-store-server bucket snapshot show -vserver vs0 -bucket training-data
By re-running the training runs against each bucket snapshot, they can narrow down what has changed. Once the first passing and failing snapshots are identified, Alex shares these with the developers to help pinpoint what changes may be causing the failures.

== Restore S3 snapshots

aws cp" command based on the contents provided by the snapshot browsing functionality.

Alex decides to create a snapshot of the bucket before the update takes place, just in case:

vserver object-store-server bucket snapshot create -vserver vs0 -bucket website-data -snapshot pre-update

Alex can restore the whole bucket, objects with a prefix or a single object using the "aws s3 cp" command.

Restore the bucket

aws --endpoint http://<IP> s3 cp s3://website-data-s3snap-pre-update s3://website-data  --recursive
Restore objects under a directory with prefix

aws --endpoint http://<IP> s3 cp s3://website-data-s3snap-pre-update/dir1 s3://website-data/dir1 --recursive

Restore a single object

aws --endpoint http://<IP> s3 cp s3://website-data-s3snap-pre-update/web.py s3://website-data/web.py

== Delete S3 snapshots

Alex modifies the bucket to the default snapshot policy:

vserver object-store-server bucket modify -vserver vs0 -bucket feature3-tests -snapshot-policy web-policy
Alex also takes this opportunity to free up some space by deleting the history of unnecessary snapshots for this bucket:

vserver object-store-server bucket snapshot delete -vserver vs0 -bucket feature3-tests -snapshot snapshot*

When snapshot deletion is initiated by the user or snapshot policy, we will remove the corresponding record in the snapshot database. 

In this case, the progress of individual snapshot deletion does not matter as much as being able to efficiently remove a large number of objects captured in several snapshots.