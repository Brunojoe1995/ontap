---
sidebar: sidebar
permalink: authentication/oauth2-groups.html
keywords: oauth 2.0, oauth2, identity mapping, group uuid, group name, group mapping, external roles, role mapping
summary: "ONTAP provides several options for configuring groups based on your authorization server. The groups can then be mapped to roles which are used by ONTAP to determine access."
---

= Working with groups
:hardbreaks:
:nofooter:
:icons: font
:linkattrs:
:imagesdir: ./media/

[.lead]
ONTAP provides several options for configuring groups based on your authorization server. The groups can then be mapped to roles which are used by ONTAP to determine access.

== How groups are identified

When you configure a group at an authorization server, it is identified and carried in an OAuth 2.0 access token using either a name or UUID. You need to be aware of how your authorization handles groups before configuring ONTAP.

[NOTE]
If multiple groups are included in an access token, ONTAP will attempt to use each one until there is a match.

=== Group names

Many authorization servers identify and represent groups using a name. Here is an example of a token generated by Active Directory Federation Service (ADFS) which contains several groups. See <<Manage groups with names>> for more information.

[source,json]
{
  "aud": "microsoft:identityserver:4cee3b2b-9f38-44ba-8d41-d73c3b76f8f3",
  "iss": "http://scs000131326.gdl.englab.netapp.com/adfs/services/trust",
  "iat": 1688144115,
  "exp": 1688147715,
  "sub": "User_DevProd@MIGAD2.COM",
  "group": [
    "MIGAD2\\Domain Users",
    "MIGAD2\\Development Group",
    "MIGAD2\\Production Group"
  ],
  "apptype": "Confidential",
  "appid": "4cee3b2b-9f38-44ba-8d41-d73c3b76f8f3",
  "authmethod": "urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport",
  "auth_time": "2023-06-30T16:55:15.037Z",
  "ver": "1.0"
}

=== Group UUIDs

Some authorization servers identify and represent groups using a UUID. Here is an example of a token generated by Microsoft Entra ID which contains several groups. See <<Manage groups with UUIDs>> for more information.

[source,json]
{
  "aud": "ee468532-2aab-43d5-b5f9-fd90f3d34881",
  "iss": "https://sts.windows.net/6ca7eb8c-3857-4bf5-ba5c-033297e20dc2/",
  "iat": 1689196499,
  "nbf": 1689196499,
  "exp": 1689201253,
  "acr": "1",
  "aio": "ATQAy/8TAAAAMtsSBE0oPqLp1qpJM8U8+Rzq27oPOxyvYO1nWkoXJeg9FG8GJI7WIhkJ+CxDGw/y",
  "amr": [
    "pwd"
  ],
  "appid": "ee468532-2aab-43d5-b5f9-fd90f3d34881",
  "appidacr": "1",
  "groups": [
    "79d2c5b0-adfa-4e66-9a0b-cd395474b557",
    "d3ec715d-4141-417e-ad92-2c6bd5dd37cf",
    "72f4b6aa-ccaf-4b5e-9e4e-7a2c238ab647",
    "b347bb83-38c1-4bd7-a974-28fb317ebca5",
    "c9c58fc2-e6e6-4cb7-b651-59bd831845d5"   ],
  "ipaddr": "216.240.30.11",
  "name": "admin2 with group membership",
  "oid": "8f6de82b-325a-470d-9c1c-8edb05b74139",
  "preferred_username": "admin2@netappsecdev.onmicrosoft.com",
  "rh": "0.Ab0AjOunbFc49Uu6XAMyl-INwjKFRu6rKtVDtfn9kPPTSIG9AH4.",
  "sub": "I_gyDbMsTIO4HUH0uQQWXaP96vGNgt0JR_GbvrmkUug",
  "tid": "6ca7eb8c-3857-4bf5-ba5c-033297e20dc2",
  "unique_name": "admin2@netappsecdev.onmicrosoft.com",
  "upn": "admin2@netappsecdev.onmicrosoft.com",
  "uti": "5xETkFuuAEakdnSsbjgHAA",
  "ver": "1.0"
}

== Manage groups with names

If your authorization server uses names to identify groups, you need to make sure the group is defined to ONTAP. 

Here's an example of a CLI command defining a group to ONTAP. If you're already using Active Directory or LDAP to configure your groups, you might already have the group defined.

.Example
----
security login create -user-or-group-name "MIGAD2\\Domain Users" -application http -authentication-method domain -role admin
----

[NOTE]
You can also configure this feature using the ONTAP REST API. See the https://docs.netapp.com/us-en/ontap-automation/[ONTAP Automation^] documentation site for more information.

== Manage groups with UUIDs

If your authorization server represents groups using UUID values, you need to perform a two-step configuration before using the groups. Beginning with ONTAP 9.16.1, two mapping features are available and have been tested with Microsoft Entra ID.

[NOTE]
You can also configure these features using the ONTAP REST API. See the https://docs.netapp.com/us-en/ontap-automation/[ONTAP Automation^] documentation site for more information.

.Related information

* https://docs.netapp.com/us-en/ontap-cli/[ONTAP CLI commands^]

=== Map a group UUID to a group name

If you're using an authorization server that represents groups using UUID values, you need to map the group UUIDs to group names. The primary ONTAP CLI operations are described below. You need to be at the ONTAP *admin* privilege level to issue the commands.

==== Create

You can define a new group mapping configuration with the `security login group create` command. The group name should match the name used at the authorization server.

.Parameters
The parameters used to create a group mapping are described below.

[cols="30,70"*,options="header"]
|===
|Parameter
|Description
|`vserver`
|Optionally specifies the name of the SVM (vserver) the group is associated with. If omitted, the group is associated with the ONTAP cluster.
|`name`
|The unique name of the group that ONTAP will use.
|`type`
|This value indicates the identity provider the group originates from.
|`uuid`
|Specifies the universally unique identifier of the group as provided by the authorization server.
|===

.Example
----
security login group create -vserver ontap-cls-1 -name IAM_Dev -type entra -uuid 79d2c5b0-adfa-4e66-9a0b-cd395474b557
----

After creating the group, a unique read-only integer identifier is generated for the group.

==== Additional CLI operations

The command supports several additional operations, including:

* Show
* Modify
* Delete

You can use the `show` option to retrieve the unique group ID generated for a group. Refer to the ONTAP commands reference documentation or ONTAP CLI man pages for more information.

=== Map a group UUID to a role

If you're using an authorization server that represents groups using UUID values, you can map the group to a role. The primary ONTAP CLI operations are described below. Also, you need to be at the ONTAP *admin* privilege level to issue the commands.

[NOTE]
You need to first <<Map a group UUID to a group name>> and retrieve the unique integer ID generated for the group. You'll need the ID to map the group to a role.

==== Create

You can define a new role mapping with the `security login group role-mapping create` command.

.Parameters
The parameters used to map a group to a role are described below.

[cols="30,70"*,options="header"]
|===
|Parameter
|Description
|`group-id`
|Specifies the unique ID generated for the group using the command `security login group create`.
|`role`
|The name of the ONTAP role the group is mapped to.
|===

.Example
----
security login group role-mapping create -group-id 1 -role admin
----

==== Additional CLI operations

The command supports several additional operations, including:

* Show
* Modify
* Delete

Refer to the ONTAP commands reference documentation or ONTAP CLI man pages for more information.

// DMP - November 5 2024 - ONTAPDOC-2163
