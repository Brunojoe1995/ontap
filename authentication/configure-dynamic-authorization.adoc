---
permalink: authentication/configure-dynamic-authorization.html
sidebar: sidebar
keywords: dynamic, authorization, framework, security, login, ssh
summary: "Configure the Dynamic Authorization Framework to increase security of SSH logins and execution of certain commands under suspicious circumstances."
---
= Configure Dynamic Authorization
:icons: font
:imagesdir: ../media/

[.lead]
As an administrator, you can configure Dynamic Authorization to increase the security of remote administrator connections to ONTAP.

You can configure the following Dynamic Authorization settings depending on your needs:

* <<Configure Dynamic Authorization global settings>>
* <<Configure Dynamic Authorization trust score components>>
* <<Configure a custom trust score provider>>
* <<Configure restricted commands>>
* <<Configure Dynamic Authorization groups>>
* <<Configure Dynamic Authorization groups>>


== Configure Dynamic Authorization global settings
You can configure global settings for Dynamic Authorization such as the storage VM to secure, the suppression interval for authentication challenges, and the trust score settings. 

.About this task
For more information about the parameters for the `security dynamic-authorization modify` command, refer to the https://docs.netapp.com/us-en/ontap-cli-9151/security-dynamic-authorization-modify.html[ONTAP manual pages^].

// * Lower challenge boundary: The lower multifactor authentication challenge boundary percentage. If a trust score drops below this boundary, the user's activity request is denied. If it falls between the lower and upper boundary, a further authentication challenge is presented to the user. The default value is 0. Valid values are 0 to 99.
//* Upper challenge boundary: The upper multifactor authentication challenge boundary percentage. If a trust score is above this boundary, the activity request is allowed. If it falls between the lower and upper boundary, a further authentication challenge is presented to the user. The default value is 90. Valid values are 0 to 100.
//* Suppression interval: When a user enters a series of restricted commands within a short interval, multiple authentication prompts are suppressed for the length of time defined by the suppression interval. The default value is 10 minutes. You can set a suppression interval of 1 minute to 1 hour.

.Steps

. Configure global settings for Dynamic Authorization. If you don't use the `-vserver` parameter, the command is run at the cluster level. Update the values in brackets <> to match your environment. Parameters in bold are required:
+
[source,console,subs="verbatim,quotes"]
----
security dynamic-authorization modify \
*_-lower-challenge-boundary <percent>_* \
*-upper-challenge-boundary <percent>* \
-suppression-interval <interval> \
-vserver <storage_VM_name>
----
. View the resulting configuration: 
+
[source,console]
----
security dynamic-authorization show 
----

== Configure Dynamic Authorization trust score components
You can configure the trust score maximum score weight to change priority of scoring criteria or to remove certain criteria from risk scoring.

.About this task
For more information about the parameters for the `security dynamic-authorization trust-score-component modify` command, refer to the https://docs.netapp.com/us-en/ontap-cli-9151/security-dynamic-authorization-trust-score-component-modify.html[ONTAP manual pages^].


The default raw score weights and percentage weights are the following:
[cols="3*"]
|===
h|Criteria h|Default raw score weight h|Default percentage weight

|Geolocation
|20
|20

|Access time
|20
|20

|Trusted device
|20
|20

|User login authentication history
|20
|20

|History of user authorization failures
|20
|20

a|*Total score*
|100
|100

|===

You can modify the following components:

[cols="2*"]
|===
h|Component name h|Description

|trusted-device
|Trusted device

|authentication-history
|User login authentication history

|===

.Steps

. Modify trust score components. Update the values in brackets <> to match your environment. If you don't use the `-vserver` parameter, the command is run at the cluster level. Parameters in bold are required: 
+
[source,console,subs="verbatim,quotes"]
====
security dynamic-authorization trust-score-component modify \
*-component <component-name>* \
*-weight <integer>* \
-vserver <storage_VM_name>
====
. View the resulting trust score component settings: 
+
[source,console]
----
security dynamic-authorization trust-score-component show 
----

=== Reset the trust score for a user
If a user is denied access due to system policies and is able to prove their identity, the administrator can use reset the user's trust score. 

.About this task
For more information about the parameters for the `security dynamic-authorization user-trust-score reset` command, refer to the https://docs.netapp.com/us-en/ontap-cli-9151/security-dynamic-authorization-user-trust-score-reset.html[ONTAP manual pages^].

.Steps

. Add the command. Refer to <<Configure Dynamic Authorization trust score components>> for a list of trust score components that you can reset. Update the values in brackets <> to match your environment. If you don't use the `-vserver` parameter, the command is run at the cluster level. Parameters in bold are required:
+
[source,console,subs="quotes"]
----
security dynamic-authorization user-trust-score reset \
*-username <username>* \
*-component <component-name>* \
-vserver <storage_VM_name>
----

=== Display your trust score
A user can display their own trust score for a login session.

.Steps

. Display your trust score:
+
[source,console]
----
security login whoami
----
+
You should see output similar to the following:
+
----
User: admin
Role: admin
Trust Score: 50
----

== Configure a custom trust score provider
If you already receive scoring methods from an external trust score provider, you can add the custom provider to the Dynamic Authorization configuration.


.Before you begin
* The custom trust score provider must return a JSON response. The following syntax requirements must be met:
** The field that returns the trust score must be a scalar field and not an element of an array.
** The field that returns the trust score can be a nested field, e.g. `trust_score.value`.
** There must be a field within the JSON response that returns a numeric trust score. If this is not natively available, the customer can write a wrapper script to return this value.
* The value can be either a trust score or a risk score. The difference is that the trust score is in ascending order with a higher score denoting a higher trust level, while the risk score is in descending order. For example, a trust score of 90 for a score range of 0 to 100 indicates that the score is very trustworthy and likely to result in an "allow" without additional challenge, while a risk score of 90 for a score range of 0 to 100 indicates high risk and likely to result in a "deny" without an additional challenge.
* The custom trust score provider must be be accessible via the REST API.
* The custom trust score provider must be configurable using one of the supported parameters. Custom trust score providers that require configuration that is not in the supported parameter list are not supported.

.About this task
For more information about the parameters for the `security dynamic-authorization trust-score-component create` command, refer to the https://docs.netapp.com/us-en/ontap-cli-9151/security-dynamic-authorization-trust-score-component-create.html[ONTAP manual pages^].

.Steps

. Add a custom trust score provider. Update the values in brackets <> to match your environment.If you don't use the `-vserver` parameter, the command is run at the cluster level. Parameters in bold are required:
+
[source,console,subs="verbatim,quotes"]
----
security dynamic-authorization trust-score-component create \
-component<text> \
*-provider-uri <text>* \
-score-field <text> \
-min-score <integer> \
*-max-score <integer>* \
*-weight <integer>* \
-secret-access-key <text> \
-provider-http-headers <list<header,header,header>> \
-vserver <storage_VM_name>
----
. View the resulting trust score provider settings:
+
[source,console]
----
security dynamic-authorization trust-score-component show 
----

=== Configure custom trust score provider tags
You can communicate with external trust score providers using tags. This enables you to send information in the URL to the trust score provider without exposing sensitive information.

.About this task
For more information about the parameters for the `security dynamic-authorization trust-score-component create` command, refer to the https://docs.netapp.com/us-en/ontap-cli-9151/security-dynamic-authorization-trust-score-component-create.html[ONTAP manual pages^].

.Steps

. Enable trust score provider tags. Update the values in brackets <> to match your environment. If you don't use the `-vserver` parameter, the command is run at the cluster level. Parameters in bold are required:
+
[source,console,subs="verbatim,quotes"]
----
security dynamic-authorization trust-score-component create \
*-component <component_name>* \
-weight <initial_score_weight> \
-max-score <max_score_for_provider> \
*-provider-uri <provider_URI>* \
-score-field <REST_API_score_field> \
*-secret-access-key "<access_key_text>"*
----
+
For example: 
+
[source,console]
----
security dynamic-authorization trust-score-component create -component comp1 -weight 20 -max-score 100 -provider-uri https://<url>/trust-scores/users/<user>/<ip>/component1.html?api-key=<access-key> -score-field score -access-key "MIIBBjCBrAIBArqyTHFvYdWiOpLkLKHGjUYUNSwfzX"
----

== Configure restricted commands
When you enable Dynamic Authorization, the feature includes a default set of restricted commands. You can modify this list to suit your needs. Refer to the link:../multi-admin-verify/index.html[multi-admin verification (MAV) documentation^] for information on the default list of restricted commands.

=== Add a restricted command
You can add a command to the list of commands that are restricted with Dynamic Authorization.

.About this task
For more information about the parameters for the `security dynamic-authorization rule create` command, refer to the https://docs.netapp.com/us-en/ontap-cli-9151/security-dynamic-authorization-rule-create.html[ONTAP manual pages^].

.Steps

. Add the command. Update the values in brackets <> to match your environment. If you don't use the `-vserver` parameter, the command is run at the cluster level. Parameters in bold are required:
+
[source,console,subs="verbatim,quotes"]
----
security dynamic-authorization rule create \
-query <query> \
*-operation <text>* \
-index <integer> \
-vserver <storage_VM_name>
----

. View the resulting list of restricted commands:
+
[source,console]
----
security dynamic-authorization rule show
----

=== Remove a restricted command
You can remove a command from the list of commands that are restricted with Dynamic Authorization.

.About this task
For more information about the parameters for the `security dynamic-authorization rule delete` command, refer to the https://docs.netapp.com/us-en/ontap-cli-9151/security-dynamic-authorization-rule-delete.html[ONTAP manual pages^].

.Steps

. Remove the command. Update the values in brackets <> to match your environment. If you don't use the `-vserver` parameter, the command is run at the cluster level. Parameters in bold are required:
+
[source,console,subs="verbatim,quotes"]
----
security dynamic-authorization rule delete \
*-operation <text>* \
-vserver <storage_VM_name>
----
. View the resulting list of restricted commands:
+
[source,console]
----
security dynamic-authorization rule show
----

== Configure Dynamic Authorization groups
By default, Dynamic Authorization applies to all users and groups as soon as you enable it. However, you can create groups using the `security dynamic-authorization group create` command, so that Dynamic Authorization only applies to those specific users.

=== Add a Dynamic Authorization group
You can add a Dynamic Authorization group.

.About this task
For more information about the parameters for the `security dynamic-authorization group create` command, refer to the https://docs.netapp.com/us-en/ontap-cli-9151/security-dynamic-authorization-group-create.html[ONTAP manual pages^].

.Steps

. Create the group. Update the values in brackets <> to match your environment. If you don't use the `-vserver` parameter, the command is run at the cluster level. Parameters in bold are required:
+
[source,console]
----
security dynamic-authorization group create \
*-group-name <group-name>* \
-vserver <storage_VM_name> \
-exclude-users <user1,user2,user3...>

----
. View the resulting Dynamic Authorization groups:
+
[source,console]
----
security dynamic-authorization group show
----

=== Remove a Dynamic Authorization group
You can remove a Dynamic Authorization group.

.Steps

. Delete the group. Update the values in brackets <> to match your environment. If you don't use the `-vserver` parameter, the command is run at the cluster level. Parameters in bold are required:
+
[source,console]
----
security dynamic-authorization group delete \
*-group-name <group-name>* \
-vserver <storage_VM_name>
----
. View the resulting Dynamic Authorization groups:
+
[source,console]
----
security dynamic-authorization group show
----

=== Overriding restricted commands with excluded users or groups
You can configure Dynamic Authorization to not be enforced for users in excluded groups.

.Steps
. Enable the `groupauth.cache.enable` option:
. What are the other commands here??? Functional spec seems incomplete. How do you exclude an entire group, or list of groups?  It seems that you can only exclude users within a group.

