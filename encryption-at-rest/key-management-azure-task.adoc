---
permalink: encryption-at-rest/key-management-azure-task.html
sidebar: sidebar
keywords: key management, Azure, AKV, key vault, NVE keys, third-party
summary: "Use Azure Key Vault (AKV) to streamline the protection of your ONTAP encryption keys."
---
= Manage keys with Azure Key Vault
:icons: font
:imagesdir: ../media/
:hardbreaks:

You can use link:https://docs.microsoft.com/en-us/azure/key-vault/general/basic-concepts[Azure Key Vault (AKV)] to protect your ONTAP encryption keys in an Azure-deployed application.

AKV can be used to protect NetApp Volume Encryption (NVE) keys only for data vservers. 

Key management with AKV can be implemented with the CLI or the ONTAP REST API. 

When using AKV, be aware that by default a data vserver LIF is used to communicate with the cloud KMS endpoint. A node management network is used to communicate with Azure's authentication services (login.microsoftonline.com). If the cluster network is not configured correctly, the cluster will not utilize the key manager service. 

.Prerequisites
* The ONTAP cluster's nodes must support NVE 
* Volume Encryption (VE) license installed 
* Multi-tenant Encryption Key Management (MTEKM) license installed 
* You must be a cluster or vserver administrator 

.Limitations
* AKV is not available for MetroCluster configurations.
* AKV is not available for NSE and NAE. link:enable-external-key-management-96-later-nve-task.html[External KMIPs] can still be used instead 
* AKV can only be configured on a data vserver 

.Enable AKV with the CLI 
. Before you begin, you should have obtain the appropriate authentication method from your Azure account. In ONTAP 9.9.1, you can only use a client secret. Beginning in ONTAP 9.10.1, you can use a client secret or certificate.  
. Set privileged level to advanced 
`set -priv advanced`
. Ensure all nodes in the cluster are healthy 
`cluster show`
If the service reachability is not OK, establish the connectivity to the AKV key management service via data vserver LIF. 
. Enable AKV on the SVM
`security key-manager external azure enable -client-id _client_id_ -tenant-id _tenant_id_ -name -key-id _key_id_ -authentication-method {certificate|client-secret}`
If you are working in ONTAP 9.9.1, there is no need to flag an authentication method.Beginning in ONTAP 9.10.1, you must select a client secret or certificate as the authentication method. 
. When prompted, enter either the client certificate or client secret from your Azure account. 
. Verify AKV is enabled correctly: 
`security key-manager external azure show vserver _vserver_name_`
[NOTE] 
If one or more encrypted volumes is already configured for a data vserver and the corresponding NVE keys are managed by the admin vserver onboard key manager, those keys should be migrated to AKV. To do this with the CLI, run:  
`security key-manager key migrate -from-Vserver _admin_vserver_ -to-Vserver _data_vserver_`
New encrypted volumes cannot be created for the tenant's data vserver until all NVE keys of the data vserver are successfully migrated. 