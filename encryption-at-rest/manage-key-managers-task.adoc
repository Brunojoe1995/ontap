---
permalink: encryption-at-rest/manager-key-managers.html
sidebar: sidebar
keywords: external key manager, configure external key manager, migrate keys, store keys, authentication keys, encryption keys
summary: "Beginning with ONTAP 9.13.1, you can use System Manager to manage external key managers to store and manage authentication and encryption keys."
---
= Manage external key managers
:icons: font
:imagesdir: ../media/

[.lead]
Beginning with ONTAP 9.13.1, you can use System Manager to manage external key managers to store and manage authentication and encryption keys.  

You can use both the Onboard Key Manager (beginning with ONTAP 9.7) and external key managers to store and manage authentication and encryption keys.  

The Onboard Key Manager is used to store and manage keys in a secure database that is internal to the cluster.  An external key manager stores and manages keys, but it is external to the cluster.  One or more external key managers can be used to store and manage keys.

The scope of the Onboard Key Manager is at the cluster level; however, the scope of external key managers can be at either the cluster level or a storage VM level.

If the Onboard Key Manager is enabled, an external key manager cannot be enabled at the cluster level, but it can be enabled at the storage VM level. Conversely, if an external key manager is enabled at the cluster level, the Onboard Key Manager cannot be enabled.

When using external key managers, you can register up to four primary key servers per storage VM and cluster.  Each primary key server can be clustered with up to three secondary key servers.

== Configure external key managers

.Before you start

To add an external key manager for a storage VM, you should add an optional gateway when you configure the network interface for the storage VM. If the storage VM was created without the network route, you will have to create the route explicitly for the external key manager.  

.Steps

You can start to configure an external key manager from different locations in System Manager.

. To start configuring an external key manager, perform one of the following starting steps, and then proceed to the next step.
+
[cols="25,25,50"]
|====

h| Workflow  h| Navigation  h| Starting step

a| Configure Key Manager
a| *Settings* > *Security*
a| In the *Encryption* section, select image:icon_gear.gif[settings icon].

a| Add local tier
a| ????
a| Check the check box labeled "Configure Key Manager".

a| Prepare storage
a| *Dashboard*
a| In the *Capacity* section, select *Prepare Storage*.  Then, select "Configure Key Manager".

a| Configure MetroCluster system
a| ????
a| ????

a| Configure encryption (key manager at storage VM scope only)
a| *Storage VMs*
a| In the *Encryption* section under *Security*, select image:icon_gear.gif[settings icon].

|====

. Select *External Key Manager*.

. Existing key servers are listed in the *Key Servers* table.  Perform the following actions as needed:
+
[cols="40,60"]
|====

h| To perform this action ... h| Perform these steps...

a| Add a primary key server	
a| Click image:icon_add.gif[+Add], and complete the *IP Address or Host Name* and *Port* fields.

a| Add a secondary key server	
a| Hover over the key server IP address or host name, select image:icon_kabob.gif[kebab icon]., then select *Add Secondary Key Server*. Complete the *IP Address or Host Name* field.

a| Delete a primary key server	
a| Hover over the key server IP address or host name, select image:icon_kabob.gif[kebab icon], then select *Delete*.  

*Note*: To be deleted, a server cannot contain keys.

a| Delete a secondary key server
a| Remove the text input.

|====

. Existing installed certificates are listed in the *KMIP Server CA Certificates* and *KMIP Client Certificate* fields.  You can perform any of the following actions:

* Click image:icon_dropdown_arrow.gif[pull-down arrow] to select installed certificates that you want to map to the key manager. (Multiple service CA certificates can be selected, but only one client certificate can be selected.)

* Select *Add New Certificate* to add a certificate that has not already been installed and map it to the external key manager.  

* Click image:icon-x-close.gif[X] next to the certificate name to delete installed certificates that you do not want to map to the external key manager.

. Click *Save* to complete the configuration.

== Migrate keys among key managers

When multiple key managers are enabled on a cluster, keys must be migrated from one key manager to another. This process is completed automatically with System Manager.

* If the Onboard Key Manager is enabled at a cluster level, and an external key manager is enabled at a storage VM level, then keys must be migrated from the Onboard Key Manager to the external key manager.  This process is completed automatically by System Manager.

* If volumes were created without encryption on a storage VM before the Onboard Key Manager was enabled on the cluster and an external key manager was enabled on the storage VM, then keys do not need to be migrated.

* If volumes were created with encryption on a storage VM before the Onboard Key Manager was enabled on the cluster and an external key manager was enabled on the storage VM, then the keys need to be migrated.  System Manager handles this process in the background because it takes time.  Error messages might be displayed until this process completes.

// 2023 Apr 27, ONTAPDOC-848
