---
permalink: encryption-at-rest/manage-keys-google-task.html
sidebar: sidebar
keywords: key management, GCP, google cloud, GCP KMS, NVE keys, third-party
summary: "Use Google's Cloud Key Manager Service (Cloud KMS) to streamline the protection of your ONTAP encryption keys."
---
= Manage keys with Google Cloud Platform's Key Management Service
:icons: font
:imagesdir: ../media/

[.lead]
You can use link:https://cloud.google.com/kms/docs[Google Cloud Platform's Key Management Service (Cloud KMS)] to streamline the protection of your ONTAP encryption keys in a GCP-deployed application.

Cloud KMS can be used to protect NetApp Volume Encryption (NVE) keys only for data vservers. 

Key management with Cloud KMS can be implemented with the CLI or the ONTAP REST API.  

When using Cloud KMS, be aware that by default a data vserver LIF is used to communicate with the cloud KMS endpoint. A node management network is used to communicate with Google Cloud Platform's authentication services (oauth2.googleapis.com). If the cluster network is not configured correctly, the cluster will not utilize the key management service.  

.Prerequisites
* The ONTAP cluster's nodes must support NVE 
* Volume Encryption (VE) license installed 
* Multi-tenant Encryption Key Management (MTEKM) license installed 
* You must be a cluster or vserver administrator 

.Limitations
* Cloud KMS is not available for MetroCluster configurations 
* Cloud KMS is not available for NSE and NAE. link:enable-external-key-management-96-later-nve-task.html[External KMIPs] can still be used instead 
* Cloud KMS can only be configured on a data vserver 

.Enable Cloud KMS with the CLI 
. Before you begin, you should have the private key for the Google Cloud KMS account key file in a JSON format. This can be obtained from your GCP account.  
. Set privileged level to advanced 
+
`set -priv advanced`
. Ensure all nodes in the cluster are healthy 
+
`cluster show`
. Enable Cloud KMS on the SVM 
+
`security key-manager external gcp enable -vserver _data_svm_name_ -project-id _project_id_-key-ring-name _key_ring_name_ -key-ring-location _key_ring_location_ -key-name _key_name_` 
+
When prompted, enter the contents of the JSON file with the Service Account Private Key 
. Verify that Cloud KMS is configured with the correct parameters: 
+
`security key-manager external gcp show vserver _vserver_name_`
+
The status of `kms_wrapped_key_status` will be `“UNKNOWN”` if no encrypted volumes have been created.
+
If the service reachability is not OK, establish the connectivity to the GCP key management service via data vserver LIF.
. *OPTIONAL:* To migrate existing keys to the GCP KMS, run: 
+
`security key-manager key migrate -from-Vserver _admin_Vserver_ -to-Vserver _data_Vserver_` 

